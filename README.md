# ðŸ¤– XT-404 Skynet : Wan 2.2 Sentinel Suite (OMEGA EDITION)
### Cyberdyne Systems Corp. | Series T-800 | Model 101

<p align="center">
  <img src="https://img.shields.io/badge/Version-v31.0_PLATINUM-e6e6e6?style=for-the-badge" alt="Version">
  <img src="https://img.shields.io/badge/Architecture-Wan_2.2-00bfff?style=for-the-badge" alt="Architecture">
  <img src="https://img.shields.io/badge/Engine-T_3000_Genisys-ff0000?style=for-the-badge" alt="Engine">
  <img src="https://img.shields.io/badge/Module-T_X_Polymetric-purple?style=for-the-badge" alt="New Module">
</p>

> *"The future is not set. There is no fate but what we make for ourselves."*

---

## âš ï¸ CRITICAL SYSTEM DEPENDENCY

> [!CAUTION]
> **INFILTRATION PROTOCOL (GGUF):**
> To utilize GGUF Quantized Models with the **Cyberdyne Model Hub**, the **ComfyUI-GGUF** engine is **REQUIRED**.
>
> ðŸ“¥ **Download Engine:** `city96/ComfyUI-GGUF`
>
> *Without this engine, the Cyberdyne Model Hub will operate in Safetensors-only mode.*

---

## ðŸš€ WHY CHOOSE XT-404 SKYNET? (Competitive Analysis)

Standard nodes rely on generic implementations. **XT-404 Skynet** is a custom-engineered architecture built specifically for the quirks of **Wan 2.2**.

| Feature | Standard Nodes / Competition | ðŸ¤– XT-404 Skynet Architecture |
| :--- | :--- | :--- |
| **Precision** | Standard FP16/BF16 (Prone to Banding) | **Hybrid FP32/TF32 Contextual Switching** (Zero Banding) |
| **Interpolation** | Basic Linear Fades (Static/Frozen) | **T-X Dual-Phase Wrapper** (Native VAE Injection) |
| **Color Science** | RGB Clipping | **LAB Space Transfer & OLED Dynamics** (Cinema Grade) |
| **Caching** | Basic TeaCache (Motion Freeze Risk) | **T-3000 Genisys** w/ Kinetic Momentum & Nano-Repair |
| **Scaling** | Bilinear (Blurry) | **Lanczos/Bicubic FP32** (Pixel Perfect) |
| **Memory** | High VRAM Usage (OOM Risk) | **Surgical Pinned Memory (DMA)** & Aggressive Purge |

---

## ðŸŒ NEURAL NET NAVIGATION

### ðŸ‡ºðŸ‡¸ [ENGLISH DOCUMENTATION](#-english-documentation)
1.  **[Visual Engineering (Wan Chroma Mimic)](#-phase-0-visual-engineering-wan-chroma-mimic-new)**
2.  **[Infiltration (Model Loader)](#-phase-1-infiltration-cyberdyne-model-hub)**
3.  **[Neural Net Core (XT-404 Samplers)](#-phase-2-neural-net-core-xt-404-samplers)**
4.  **[T-3000 Genisys (Omniscient Cache)](#-phase-3-t-3000-genisys-omniscient-cache)**
5.  **[Mimetic Rendering (I2V Ultra & Fidelity)](#-phase-4-mimetic-rendering-i2v-ultra--fidelity)**
6.  **[Polymetric Alloy (T-X Dual-Phase)](#-phase-65-polymetric-alloy-t-x-dual-phase-new)** ðŸ†•
7.  **[Sensors & Accelerators (Omega Tools)](#-phase-5-sensors--accelerators-omega-tools)**
8.  **[Post-Processing & Automation](#-phase-6-post-processing--automation)**

### ðŸ‡«ðŸ‡· [DOCUMENTATION FRANÃ‡AISE](#-documentation-franÃ§aise)
*Consultez la version franÃ§aise pour les dÃ©tails techniques complets.*

---

# ðŸ‡ºðŸ‡¸ ENGLISH DOCUMENTATION

## ðŸŽ¨ Phase 0: Visual Engineering (Wan Chroma Mimic)

**File:** `wan_chroma_mimic.py`

**The Ultimate Color Grading Engine.** This is not a simple filter. It operates in **real-time on the GPU**, converting image tensors to the **LAB Color Space** to separate luminance from color information, allowing for cinema-grade referencing without destroying lighting data.

### ðŸ”¥ Key Features & Configuration
*   **Architecture:** 100% PyTorch GPU. 0% CPU latency.
*   **Morphological Filter:** Removes micro-artifacts (black/white dots) generated by video diffusion before they expand.
*   **OLED Dynamics:** Applies a non-linear S-Curve centered on 0.5 to deepen blacks while preserving peak highlights.

| Parameter | Recommended | Description |
| :--- | :--- | :--- |
| `reference_image` | **REQUIRED** | The source image (style reference). The mood is extracted from here. |
| `effect_intensity` | **0.25** | Blending strength of the LAB transfer. |
| `oled_contrast` | **0.00** | **The "Netflix" Look.** Boosts dynamic range. 0.0 = Neutral. |
| `skin_metal_smooth` | **0.25** | **Smart Surface Blur.** Smoothes skin/metal but detects edges to keep sharpness. |
| `detail_crispness` | **0.2** | **Cinema PiquÃ©.** Enhances micro-details using a difference-of-gaussians approach. |

---

## ðŸ›¡ï¸ Phase 1: Infiltration (Cyberdyne Model Hub)

**File:** `cyberdyne_model_hub.py`

A unified loader bridging Safetensors and GGUF architectures. It solves the "Dual-UNet" requirement of Wan 2.2 automatically.

*   **Recursive Scanner:** Finds models in subfolders.
*   **Skynet Protocol:** Active VRAM management. It calculates the checksum (SHA256) and purges memory *before* loading to prevent fragmentation.
*   **Hybrid Loading:** Can load a High-Res FP16 model and a Low-Res GGUF model simultaneously.

---

## ðŸ§  Phase 2: Neural Net Core (XT-404 Samplers)

**File:** `XT404_Skynet_Nodes.py`

The "Sentinel" engine. Unlike standard samplers, these are hard-coded with the **`simple` (Linear)** scheduler required by Wan 2.2, preventing the "fried output" issues seen with standard KSamplers.

### ðŸ”´ XT-404 Skynet 1 (Master)
*   **Shift Value (5.0):** The critical setting for Wan 2.2 latent timing.
*   **Bongmath Engine:** A custom texture-noise injection system.
    *   `True`: Adds analog film grain coherence.
    *   `False`: Pure digital cleanliness.

### ðŸŸ¡ XT-404 Skynet 2 (Chain)
*   **Seed Lock:** Automatically inherits the seed from the Master node via the `options` dictionary. Ensures temporal consistency across generation passes.

### ðŸŸ¢ XT-404 Skynet 3 (Refiner)
*   **Resample Mode:** Injects controlled noise at the end of the chain to hallucinate high-frequency details.

---

## ðŸ’€ Phase 3: T-3000 Genisys (Omniscient Cache)

**File:** `wan_genisys.py`

**Superior to TeaCache.** Standard TeaCache freezes video motion when the difference is too low. **T-3000** uses "Kinetic Momentum".

*   **Kinetic Momentum:** If motion is detected, it *forces* the next X frames to calculate, preventing the "mannequin challenge" effect.
*   **Nano-Repair:** Detects `NaN` or `Inf` values (black screen bugs) in the tensor stream and surgically repairs them using soft-clamping (-10/+10) instead of hard clipping.
*   **HUD:** Displays real-time signal integrity and drift metrics in your console.

---

## ðŸŽ­ Phase 4: Mimetic Rendering (I2V Ultra & Fidelity)

**Files:** `nodes_wan_ultra.py` / `wan_fast.py`

### ðŸŒŸ Wan Ultra (The Quality King)
*   **Nuclear Normalization:** Sanitizes input images to strictly 0.0-1.0 range using Bicubic-AntiAlias.
*   **Detail Boost:** Applies a sharpening convolution matrix *before* VAE encoding to counteract compression blur.
*   **Motion Amp:** Uses a "Soft Limiter" (Tanh curve) to amplify motion vectors without breaking physics.

### âš¡ Wan Fidelity (The Speed King)
*   **Optimization:** Uses `torch.full` instead of concatenations for memory efficiency.
*   **Logic:** Restores the original Wan 2.1 context window logic for perfect temporal coherence.

---

## ðŸ§ª Phase 6.5: Polymetric Alloy (T-X Dual-Phase) [NEW]

**File:** `wan_tx_node.py`

**The Interpolation Singularity.** Standard I2V models struggle to reach a specific end frame (often freezing or losing style). The **T-X Engine** uses a **Native VAE Injection Wrapper** to bridge the timeline perfectly.

*   **Keyframe Injection:** Temporarily overrides the VAE's internal logic to encode [Start Frame -> Empty Void -> End Frame] without corrupting the latent space.
*   **Fluid Morphing:** Forces the Wan 2.2 model to solve the physics equation between Point A and Point B, preventing "slideshow" effects.
*   **Smart VRAM Scanner:** Automatically detects GPU capacity to switch between "Safe" (512px tiling) and "Ultra" (1280px tiling) modes.

| Parameter | Description |
| :--- | :--- |
| `start_image` | The origin frame (Frame 0). |
| `end_image` | The target frame (Frame N). The T-X engine forces convergence to this image. |
| `motion_amp` | Amplifies the latent motion vectors between keyframes. |
| `detail_boost` | Pre-processing sharpening to retain texture during VAE compression. |

---

## âš¡ Phase 5: Sensors & Accelerators (Omega Tools)

### ðŸš€ Wan Hardware Accelerator (Anti-Burn V4)
**File:** `wan_accelerator.py`
**The "Secret Sauce" of performance.**
*   **Problem:** Enabling TF32 on Wan 2.2 normally "burns" images (contrast issues) due to normalization errors.
*   **Solution (Contextual Switching):** This node enables TF32 globally for speed, but **intercepts** `GroupNorm` and `LayerNorm` layers to force them into FP32 precision.
*   **Result:** 30% speed boost of TF32 with the visual quality of FP32.

### ðŸ‘ï¸ Wan Vision & Text Cache (DMA)
**File:** `wan_i2v_tools.py`
*   **Pinned Memory:** Uses CPU Page-Locked memory (DMA) to transfer text embeddings to GPU instantly.
*   **Vision Hash:** Hashes the image content (including stride) to avoid re-encoding the same CLIP Vision input.

---

## ðŸ› ï¸ Phase 6: Post-Processing & Automation

*   **Wan Compressor (Omega):** Thread-safe H.265 encoding. Limits CPU threads to 16 to prevent Threadripper/i9 crashes.
*   **Wan Cycle Terminator:** Uses Windows API `EmptyWorkingSet` to flush RAM standby lists (prevents OS stutter).
*   **Auto Wan Optimizer:** Smart resizer that enforces `Modulo 16` dimensions (required by Wan) and protects against OOM (>1024px).

---
---

# ðŸ‡«ðŸ‡· DOCUMENTATION FRANÃ‡AISE

## ðŸŽ¨ Phase 0 : IngÃ©nierie Visuelle (Wan Chroma Mimic)

**Fichier :** `wan_chroma_mimic.py`

**Le Moteur d'Ã‰talonnage Ultime.** Ce n'est pas un simple filtre. Il fonctionne en **temps rÃ©el sur le GPU**, convertissant les tenseurs d'image vers l'espace colorimÃ©trique **LAB** pour sÃ©parer la luminance de la chrominance. Cela permet de copier l'ambiance d'une rÃ©fÃ©rence sans dÃ©truire l'Ã©clairage de la vidÃ©o gÃ©nÃ©rÃ©e.

### ðŸ”¥ FonctionnalitÃ©s ClÃ©s & RÃ©glages Pro
*   **Architecture :** 100% PyTorch GPU. 0% de latence CPU.
*   **Filtre Morphologique :** Ã‰limine les micro-artefacts (points noirs/blancs) gÃ©nÃ©rÃ©s par la diffusion vidÃ©o *avant* qu'ils ne grossissent.
*   **Dynamique OLED :** Applique une courbe en S non-linÃ©aire centrÃ©e sur 0.5 pour des noirs profonds (Pure Black) et des blancs Ã©clatants.

| ParamÃ¨tre | RecommandÃ© | Explication Technique |
| :--- | :--- | :--- |
| `reference_image` | **REQUIS** | L'image source (style). L'ambiance (Mean/Std LAB) est extraite d'ici. |
| `effect_intensity` | **0.25** | Force du mÃ©lange (Lerp) du transfert LAB. |
| `oled_contrast` | **0.00** | **Le Look "Netflix".** Boost la plage dynamique. 0.0 = Neutre. |
| `skin_metal_smooth` | **0.25** | **Smart Blur.** Lisse les aplats (peau/mÃ©tal) via dÃ©tection de variance locale, mais protÃ¨ge les bords. |
| `detail_crispness` | **0.2** | **PiquÃ© CinÃ©ma.** RÃ©hausse les hautes frÃ©quences via une diffÃ©rence de gaussiennes. |

---

## ðŸ›¡ï¸ Phase 1 : Infiltration (Cyberdyne Model Hub)

**Fichier :** `cyberdyne_model_hub.py`

Un chargeur unifiÃ© qui fait le pont entre les architectures Safetensors et GGUF. Il gÃ¨re automatiquement le besoin "Dual-UNet" de Wan 2.2.

*   **Scanner RÃ©cursif :** Trouve vos modÃ¨les mÃªme cachÃ©s dans des sous-dossiers.
*   **Protocole Skynet :** Gestion active de la VRAM. Calcule le checksum (SHA256) pour l'intÃ©gritÃ© et purge la mÃ©moire *avant* le chargement pour Ã©viter la fragmentation.
*   **Chargement Hybride :** Permet de charger un modÃ¨le Principal en FP16 (QualitÃ©) et un modÃ¨le Secondaire en GGUF (VRAM) simultanÃ©ment.

---

## ðŸ§  Phase 2 : CÅ“ur Neuronal (Samplers XT-404)

**Fichier :** `XT404_Skynet_Nodes.py`

Le moteur "Sentinel". Contrairement aux samplers standards, ceux-ci intÃ¨grent en dur le scheduler **`simple` (Linear)** requis par Wan 2.2, Ã©vitant les images "brÃ»lÃ©es" ou bruitÃ©es typiques des KSamplers mal configurÃ©s.

### ðŸ”´ XT-404 Skynet 1 (Master)
*   **Shift Value (5.0) :** Le rÃ©glage critique pour le timing latent de Wan 2.2.
*   **Moteur Bongmath :** Un systÃ¨me d'injection de texture.
    *   `True` : Ajoute une cohÃ©rence de grain argentique (Film).
    *   `False` : Rendu numÃ©rique pur (Digital).

### ðŸŸ¡ XT-404 Skynet 2 (Chain)
*   **Verrouillage Seed :** HÃ©rite automatiquement de la seed du nÅ“ud Master via le dictionnaire `options`. Garantit une cohÃ©rence temporelle parfaite entre les passes.

### ðŸŸ¢ XT-404 Skynet 3 (Refiner)
*   **Mode Resample :** RÃ©injecte du bruit contrÃ´lÃ© en fin de chaÃ®ne pour "halluciner" des dÃ©tails haute frÃ©quence manquants.

---

## ðŸ’€ Phase 3 : T-3000 Genisys (Cache Omniscient)

**Fichier :** `wan_genisys.py`

**SupÃ©rieur Ã  TeaCache.** Le TeaCache standard fige le mouvement vidÃ©o quand la diffÃ©rence entre les frames est trop faible. **T-3000** utilise le "Kinetic Momentum".

*   **Kinetic Momentum (Inertie) :** Si un mouvement est dÃ©tectÃ©, il *force* le calcul des X prochaines frames, empÃªchant l'effet "mannequin challenge".
*   **Nano-Repair :** DÃ©tecte les valeurs `NaN` ou `Inf` (bugs d'Ã©cran noir) dans le flux de tenseurs et les rÃ©pare chirurgicalement via un "Soft Clamping" (-10/+10) au lieu de couper brutalement.
*   **HUD :** Affiche l'intÃ©gritÃ© du signal et la dÃ©rive (Drift) en temps rÃ©el dans la console.

---

## ðŸŽ­ Phase 4 : Rendu MimÃ©tique (I2V Ultra & Fidelity)

**Fichiers :** `nodes_wan_ultra.py` / `wan_fast.py`

### ðŸŒŸ Wan Ultra (Le Roi de la QualitÃ©)
*   **Normalisation NuclÃ©aire :** Nettoie les images d'entrÃ©e pour qu'elles soient strictement entre 0.0 et 1.0 via Bicubic-AntiAlias.
*   **Detail Boost :** Applique une matrice de convolution de nettetÃ© *avant* l'encodage VAE pour contrer le flou de compression.
*   **Motion Amp :** Utilise un "Soft Limiter" (courbe Tanh) pour amplifier les vecteurs de mouvement sans briser la physique de la scÃ¨ne.

### âš¡ Wan Fidelity (Le Roi de la Vitesse)
*   **Optimisation :** Utilise `torch.full` au lieu de concatÃ©nations lourdes pour l'efficacitÃ© mÃ©moire.
*   **Logique :** Restaure la logique de fenÃªtre contextuelle originale de Wan 2.1 pour une cohÃ©rence temporelle parfaite.

---

## ðŸ§ª Phase 6.5 : Alliage PolymimÃ©tique (T-X Dual-Phase) [NOUVEAU]

**Fichier :** `wan_tx_node.py`

**La SingularitÃ© de l'Interpolation.** Les modÃ¨les I2V standards peinent Ã  atteindre une image de fin prÃ©cise (souvent floue ou figÃ©e). Le moteur **T-X** utilise un **Wrapper VAE Ã  Injection Native** pour relier la timeline.

*   **Injection Keyframe :** Surcharge temporairement la logique interne du VAE pour encoder [DÃ©but -> Vide -> Fin] sans corrompre l'espace latent.
*   **Morphing Fluide :** Force le modÃ¨le Wan 2.2 Ã  rÃ©soudre l'Ã©quation physique entre le point A et le point B, Ã©liminant l'effet "diaporama".
*   **Smart VRAM Scanner :** DÃ©tecte automatiquement la capacitÃ© GPU pour basculer entre les modes "Safe" (Tiling 512px) et "Ultra" (Tiling 1280px).

| ParamÃ¨tre | Description |
| :--- | :--- |
| `start_image` | L'image d'origine (Frame 0). |
| `end_image` | L'image cible (Frame N). Le moteur T-X force la convergence vers celle-ci. |
| `motion_amp` | Amplifie les vecteurs de mouvement latents entre les keyframes. |
| `detail_boost` | NettetÃ© prÃ©-processus pour conserver le grain lors de la compression VAE. |

---

## âš¡ Phase 5 : Capteurs & AccÃ©lÃ©rateurs (Outils Omega)

### ðŸš€ Wan Hardware Accelerator (Anti-Burn V4)
**Fichier :** `wan_accelerator.py`
**La "Recette SecrÃ¨te" de la performance.**
*   **Le ProblÃ¨me :** Activer TF32 sur Wan 2.2 "brÃ»le" normalement les images (contraste explosÃ©) Ã  cause d'erreurs de normalisation.
*   **La Solution (Contextual Switching) :** Ce nÅ“ud active le TF32 globalement pour la vitesse, mais **intercepte** les couches `GroupNorm` et `LayerNorm` pour les forcer en prÃ©cision FP32 native.
*   **RÃ©sultat :** Gain de vitesse de 30% (TF32) avec la qualitÃ© visuelle du FP32.

### ðŸ‘ï¸ Wan Vision & Text Cache (DMA)
**Fichier :** `wan_i2v_tools.py`
*   **MÃ©moire Ã‰pinglÃ©e (Pinned Memory) :** Utilise la mÃ©moire CPU Page-Locked (DMA) pour transfÃ©rer les embeddings texte vers le GPU instantanÃ©ment.
*   **Vision Hash :** Hash le contenu de l'image (y compris via un Ã©chantillonnage stride) pour Ã©viter de rÃ©-encoder la mÃªme entrÃ©e CLIP Vision.

---

## ðŸ› ï¸ Phase 6 : Post-Production & Automatisation

*   **Wan Compressor (Omega) :** Encodage H.265 Thread-safe. Limite les threads CPU Ã  16 pour Ã©viter les crashs sur Threadripper/i9 (bug connu de x265).
*   **Wan Cycle Terminator :** Utilise l'API Windows `EmptyWorkingSet` pour vider les listes d'attente RAM (Ã©vite les micro-lags de l'OS).
*   **Auto Wan Optimizer :** Redimensionneur intelligent qui force les dimensions `Modulo 16` (requis par Wan) et protÃ¨ge contre le OOM (>1024px).

---

<p align="center">
  <i>Architected by Cyberdyne Systems. No fate but what we make.</i>
</p>
